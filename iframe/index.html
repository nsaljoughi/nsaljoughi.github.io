<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script>  
    AFRAME.registerComponent('click-handler', {
        init: function () {
            const id =  this.el.id.match(/\d+$/)[0];
            const animatedMarker = document.querySelector(`#marker_${id}`);
            const aEntity = document.querySelector(`#quest_${id}`);

            animatedMarker.addEventListener('click', function (ev, target) {
                const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
                if (aEntity && intersectedElement === aEntity && animatedMarker.object3D.visible == true) {
                    console.log(id);
                    alert('Marker ' + id)
                }
                else {
                }
            });
        }
    });

</script>
  </head>
    <body>
        <a-scene
            embedded
            arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'>

            <!-- Barcode markers -->
            <a-marker
                cursor="rayOrigin: mouse; fuseTimeout: 0;"
                id="marker_1"
                type="barcode" 
                emitevents="true"
                value="1">
                <!-- Print boxes and a text on them --> 
                <a-box id="quest_1" click-handler="1" position="0.0 0.5 0.0" material="opacity: 0.75; color: red;">
                    <a-entity rotation="-90 0 0" position="1 0.55 -0.25" scale="3 3 3" text="value: Sensor #1 \n INFO; color:black;">
                    </a-entity>
                </a-box>
            </a-marker>

            <a-marker
                cursor="rayOrigin: mouse; fuseTimeout: 0;"
                id="marker_2"
                type="barcode"
                emitevents="true"
                value="2">
                <a-box id="quest_2" click-handler="2" position="0 0.5 0"  material="opacity: 0.75; color: green;">
            	    <a-entity rotation="-90 0 0" position="1 0.55 -0.25" scale="3 3 3" text="value: Sensor #2 \n INFO; color:black;">
                    </a-entity>
                </a-box>
            </a-marker>

            <a-marker
                cursor="rayOrigin: mouse; fuseTimeout: 0;"
                id="marker_3"
                type="barcode"
                emitevents="true" 
                value="3">
                <!-- Print boxes and a text on them --> 
                <a-box id="quest_3" click-handler="3" position="0.0 0.5 0.0" material="opacity: 0.75; color: yellow;">
                    <a-entity rotation="-90 0 0" position="1 0.55 -0.25" scale="3 3 3" text="value: Sensor #3 \n INFO; color:black;">
                    </a-entity>
                </a-box>
            </a-marker>

            <a-marker
                cursor="rayOrigin: mouse; fuseTimeout: 0;"
                id="marker_4"
                type="barcode"
                emitevents="true"
                value="4">
                <a-box id="quest_4" click-handler="4" position="0 0.5 0"  material="opacity: 0.75; color: blue;">
            	    <a-entity rotation="-90 0 0" position="1 0.55 -0.25" scale="3 3 3" text="value: Sensor #4 \n INFO; color:black;">
                    </a-entity>
                </a-box>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
    </body>
</html>
